# CTG_RP_PC
ML/DL analysis of Cardiotocography (CTG) traces using Recurrence Plot and Poincaré Plot.

This repo was forked from Williams Doug's (https://github.com/williamsdoug/CTG_RP).

The original repo contained Jupyter Notebooks and code to reproduce the results of the paper [Computer-Aided Diagnosis System of Fetal Hypoxia Incorporating Recurrence Plot With Convolutional Neural Network](https://www.frontiersin.org/articles/10.3389/fphys.2019.00255/full)
 by Zhidong Zhao, Yang Zhang, Zafer Comert and Yanjun Deng.

The Notebooks and the code were adapted to check the results with Recurrence Plot and Poincaré Plot. The images were saved in the TIFF format using the DEFLATE compression scheme, considering the paper [Compression of Different Time Series Representations in Asphyxia Detection](https://ieeexplore.ieee.org/iel7/9991246/9991267/09991468.pdf)
 by Bárbara Silva, Maria Ribeiro and Teresa S. Henriques.

This work was developed during the course Special Topics in Computer Systems - Graduate Program in Computer Science - Federal University of Goiás - Brazil.

## Implementation Details

Key Jupyter Notebooks (_currently configured to run on Google Colab per below_):
- [CTG_RP_Startup_Config](https://github.com/williamsdoug/CTG_RP/blob/master/CTG_RP_Startup_Config.ipynb)
  - Initializes fresh colab instance, downloading source files, packages and dataset
  - [view using nbviewer](https://nbviewer.jupyter.org/github/williamsdoug/CTG_RP/blob/master/CTG_RP_Startup_Config.ipynb)

- [CTG_RP_Train_Model](https://github.com/williamsdoug/CTG_RP/blob/master/CTG_RP_Train_Model.ipynb)
  - Generates RP images and trains FastAI Model.  
    - RP Images based on earliest valid 10min CTG segment
    - CTG recordings partitioned into Train and Valid prior to RP generation, such that a single recording is only in Train or Valid, but not both
  - [view using nbviewer](https://nbviewer.jupyter.org/github/williamsdoug/CTG_RP/blob/master/CTG_RP_Train_Model.ipynb)
- [CTG_RP_Train_Model_Late](https://github.com/williamsdoug/CTG_RP/blob/master/CTG_RP_Train_Model_Late.ipynb)
  - Generates RP images and trains FastAI Model using Late configuration.   
    - RP Images based on latest valid 10min CTG segment prior to Stage II Labor
    - CTG recordings partitioned into Train and Valid prior to RP generation, such that a single recording is only in Train or Valid, but not both
  - [view using nbviewer](https://nbviewer.jupyter.org/github/williamsdoug/CTG_RP/blob/master/CTG_RP_Train_Model_Late.ipynb)
- [CTG_RP_Train_Model_Shuffled](https://github.com/williamsdoug/CTG_RP/blob/master/CTG_RP_Train_Model_Shuffled.ipynb)
  - Trains FastAI Model based on random partition of images into train avd valid sets  
    - CTG recordings partitioned into Train and Valid after RP generation.  RP images with configuration parameters but from same recording may appear in both Train and Valid 
    - Note:  assumes images previously generated by CTG_RP_Train_Model, CTG_RP_Train_Model_Late or CTG_RP_Generate_Recurrence_Plots notebooks
  - [view using nbviewer](https://nbviewer.jupyter.org/github/williamsdoug/CTG_RP/blob/master/CTG_RP_Train_Model_Shuffled.ipynb)


Other Notebooks:
- [CTG_RP_Display_Denoised](https://github.com/williamsdoug/CTG_RP/blob/master/CTG_RP_Display_Denoised.ipynb)
  - Displays sample denoised signals
  - [view using nbviewer](https://nbviewer.jupyter.org/github/williamsdoug/CTG_RP/blob/master/CTG_RP_Display_Denoised.ipynb)
- [CTG_RP_Generate_Recurrence_Plots](https://github.com/williamsdoug/CTG_RP/blob/master/CTG_RP_Generate_Recurrence_Plots.ipynb)
  - Creates individual RP Images.  _IMAGES_DIR/rp_images_index.json_ contains metadata associated with images for each recording
  - [view using nbviewer](https://nbviewer.jupyter.org/github/williamsdoug/CTG_RP/blob/master/CTG_RP_Generate_Recurrence_Plots.ipynb)
- [CTG_RP_Explore_Datasets](https://github.com/williamsdoug/CTG_RP/blob/master/CTG_RP_Explore_Datasets.ipynb)
  - Builds Databunch and displays contents
  - [view using nbviewer](https://nbviewer.jupyter.org/github/williamsdoug/CTG_RP/blob/master/CTG_RP_Explore_Datasets.ipynb)
- [CTG_RP_Train_ResNet_Model](https://github.com/williamsdoug/CTG_RP/blob/master/CTG_RP_Train_ResNet_Model.ipynb)
  - Uses transfer learning to train using ResNet32 model
  - [view using nbviewer](https://nbviewer.jupyter.org/github/williamsdoug/CTG_RP/blob/master/CTG_RP_Train_ResNet_Model.ipynb)


## Key Dependencies

- Data: 
  - [CTU-UHB Intrapartum Cardiotocography Database](https://physionet.org/physiobank/database/ctu-uhb-ctgdb/)
    - Paper: [Open access intrapartum CTG database](https://bmcpregnancychildbirth.biomedcentral.com/track/pdf/10.1186/1471-2393-14-16)
    - Download: 
      - `rsync -Cavz physionet.org::ctu-uhb-ctgdb  /content/ctu-uhb-ctgdb`

- Libraries:
  - [pyts](https://pyts.readthedocs.io/en/latest/)
    - Used for generation of Recurrence Plots
    - `pip install pyts`
  - [FastAI V1](https://docs.fast.ai/) library running on [PyTorch](https://pytorch.org/)
    - Used for deep learning
    - Installed by default on Google Colab
  - [wfdb](https://wfdb.readthedocs.io/en/latest/index.html)
    - Waveform Database Utilities.  Used to read Physionet Recording Files
    - `pip install wfdb`
    
- Computation:
  - [Google Colab](https://colab.research.google.com)
    - Jupyter Notebook service with no-cost access to GPU accelerated instances
